## 客户端识别

### 用户识别原因：个性化接触

HTTP是匿名、无状态的请求/响应协议。服务器处理完请求之后，向客户端会送响应。Web服务器没有信息判定请求来自哪个用户，无法对来访用户进行记录。为了提供更个性化的接触，Web站点希望对用户有更多了解，在用户浏览页面时进行追踪。

- 个性化/推荐
- 个人信息存档：避免重复提交个人信息
- 记录会话

### HTTP首部：承载用户身份信息

- From：用户Email地址
- User-Agent：用户浏览器的相关信息
- Referer：用户来源页面的URL，说明用户之前访问过的页面，了解用户的浏览行为
- 缺点：都不足以实现可靠的识别

### 客户端IP地址：识别标识

- 根据服务器IP地址识别不同用户
- 缺点
  - 客户端IP地址描述的是机器本身而不是用户，无法区分多用户使用一台机器的情况
  - 用户在每次登录时可能分配动态IP地址
  - 用户的NAT设备隐藏了实际的客户端IP
  - 服务器可能看到的是代理服务器的IP，并非客户端IP

### 用户登录

通过用户名和密码认证用户，使用Authorization首部。服务器返回401 Login Requried HTTP响应码，要求用户登录。

- 缺点
  - 登录多个Web站点会非常繁琐
  - 可能要为不同站点设置不同密码



## Cookie

Cookie是目前识别用户并实现持久会话的最好方式。

#### 1. Cookie的类型

- 会话Cookie：
  - 临时Cookie，记录用户访问网站时的设置/偏好
  - 用户退出浏览器时，会话Cookie就被删除
- 持久Cookie：
  - 储存在硬盘上，生存时间更长，浏览器退出后依然存在
  - 区别就在于过期的时间

#### 2. Cookie是如何工作的

用户首次访问站点时，服务器使用Set-Cookie HTTP响应首部将Cookie发给用户。

- Cookie中可包含任意信息，如服务器用来跟踪用户的独特识别码
- 服务器通过识别码在数据库中查找用户信息和访问记录等
- 浏览器保存Cookie内容在浏览器的数据库中，再一次请求时将Cookie一并发送出去

#### 3. Cookie保存的客户端状态

- 网景Navigator：
  - Cookie储存在cookies.txt文件中
  - Domain域；Path路径前缀；Secure安全性；Expiration过期时间；Value变量值；Name变量名
- 微软IE：
  - Cookie储存在缓存目录下的文本文件中

#### 4. 不同站点使用不同的Cookie

处于隐私和传输性能的考虑，特定的cookie只会发送给对应的服务器。

Cookie的域/路径属性：控制哪些站点可以看到这个cookie

#### 5. Cookie与缓存

私有内容需要被表示为不可缓存，对于携带Cookie首部的请求

#### 6. Cookie的安全性

Cookie的使用包含一定泄露隐私的风险，第三方站点使用持久Cookie跟踪用户导致滥用问题。

