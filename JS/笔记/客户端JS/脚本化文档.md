## 脚本化文档



### DOM概览

文档对象模型，操作HTML等文档的基础API



### 选区文档元素

#### 1. 通过ID选取元素

- 文档中ID必须唯一
- getElementById方法根据id选取元素

#### 2. 通过名字选取

- name属性，值不一定唯一，只在少数HTML元素中有效
- 只针对HTML文档，在XML中不可用
- 返回NodeList对象：包含多个Element对象的只读数组
- getElementsByName方法

#### 3. 通过标签名选取

- 返回NodeList对象

  ```javascript
  var firstpara = document.getElementsByTagName("p")[0]; // 查找第一个<p>元素
  var all = document.getElementsByTagName("*"); // 返回文档中所有元素的NodeList
  ```

#### 4. 通过CSS类选取元素

- HTML元素的class属性：常和CSS样式表使用，使一些样式拥有相同的样式

  ```javascript
  var item = document.getElementsByClassName("item");
  var item_sub = document.getElementsByClassName("item sub-menu"); // 用空格分开
  ```

#### 5. 通过CSS选择器选取元素

- CSS3选择器规范：http://www.w3.org/TR/css3-selectors

  ```javascript
  var id_video_collection = querySelectorAll("#video"); // 返回所有id="video"的元素的集合
  var first_id_video = querySelector("#video"); // 接受一个CSS选择器的字符串参数, 接受一个CSS选择器的字符串参数
  ```



### 文档结构和遍历

#### 1. Node对象

- parentNode属性：此节点的父节点，Document对象的父节点是null
- childNode属性：此节点的子节点，类数组对象，只读
- firstChild/lastChild属性：第一个/最后一个子节点
- nodeType属性：节点类型
- nodeName属性：元素标签名

#### 2. 元素树

- 去除Text/Comment节点，只考虑Element节点
- firstElementChild/firstElementChild属性
- childElementCount

例子：文档遍历函数



### 元素的属性

#### 1. 获取/设置属性

- Element对象的getAttribute/setAttribute方法：查询/设置HTML属性

- Element对象的hasAttribute/removeAttribute方法：检测存在/删除属性

  ```javascript
  var image = document.getElementByTagName("img");
  image[0].src; // Element对象的src属性
  
  var width = parseInt(image[0].getAttribute("WIDTH")); // 获取属性
  image.setAttribute("class", "thumbnail");	// 设置属性
  ```

#### 2. 数据集属性

#### 3. Attr节点的属性

- Element对象的attribute属性：类数组对象，代表元素的所有属性，只读
- document.body.attribute[0]：这样获取的值是Attr对象，是一类特殊的Node
- Attr对象：name/value属性返回属性的名字和值



### 元素的内容

#### 1. HTML类型的元素内容

- Element对象的innerHTML属性：返回元素的内容，调用web浏览器的解析器
- Element对象的outerHTML属性：返回的HTML标记的字符串，包含元素的开头/结尾标签；设置outerHTML元素本身会被替换

#### 2. 纯文本类型的元素内容

- Node对象的textContent/innerText属性：查询/插入纯文本形式的元素内容
- 区别：innerText不返回\<script>元素的内容

#### 3. Text节点类型的元素内容

例子 15-3：textContent( )函数，递归遍历元素子节点，连接后代节点中所有的Text节点的文本



### 创建/插入/删除节点

#### 1. 创建节点

- 通过Document对象定义的方法

- 通过复制已存在的节点

  ```javascript
  // 创建节点
  var img = document.getElementsByTagName("img")[0];
  var node1 = document.createElement("p");	// <p>元素
  node1.textContent = "Hello World";
  var node2 = document.createTextNode("Hello World 2"); // Text节点
  img.appendChild(node1);
  img.appendChild(node2);
  
  // 复制节点
  var img_copy = img.cloneNode(); 
  var img_deep_copy = img.cloneNode(true); // 深复制, 复制后代节点
  var img_shallow_copy = img.cloneNode(false); // 浅复制
  ```

#### 2. 插入节点

- 使用Node对象的方法

- 例子15-4：表格的行排序

  ```javascript
  // 插入节点
  img.appendChild(node1);
  img.insertBefore(node2, node1); // 将node2插入node1前面
  img.insertBefore(node2, null);  // 类似appendChild()
  ```

#### 3. 删除/替换节点

- 使用Node对象的方法删除/替换

- 例子15-5：使用innerHTML实现outerHTML

  ```javascript
  // 删除node n
  n.parentNode.removeChild(n); // 在父节点上调用
  
  // 替换node
  n.parentNode.replaceChild(new_node, n);
  ```

#### 4. DocumentFragment

- 特殊Node，其他节点的临时容器

- 可以有任意多的子节点，将一组节点当做一个节点看待

- 例子15-6：倒叙排列节点n的子节点

  ```javascript
  var frag = document.createDocumentFragment();
  frag.parentNode === null;
  ```

  

